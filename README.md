# Игра в карты

Выполнил задание: GrigLog

## Результат
Разработана игровая система, позволяющая играть в "Дурака" (карточную игру) по сети одному или множеству игроков (пока что клиенты подключаются только к localhost - для удобства тестирования).

## Описание системы
Клиенты и сервер взаимодействуют по сети через TCP сокеты. Порт сервера фиксирован - 6969.
### Клиент
Клиентское приложение очень простое - оно позволяет вводить консольные команды и печатает текстовые сообщения от сервера.
### Сервер  
Работает в 3 потока - один (реализован в `GameServer`) читает консольные команды от администратора (пока что на любой ввод сервер реагирует выключением), другой (`AcceptHandler`) принимает входящие подключения, третий (`PlayerManager`) обрабатывает команды от подключенных игроков. Вся игровая логика работает асинхронно (т.е. никакое действие одного игрока не блокирует сервер для всех игроков) в одном потоке (она довольно простая, так что проблем здесь быть не должно). 
### Поддерживаемые команды
#### В лобби
* `list` - выводит список существующих комнат
* `create <room_name> <num_players>`  - создать комнату
* `join <room_name>` - присоединиться к комнате. Это необходимо, чтобы начать игру.
#### В вашей комнате
* `list` - показать список игроков
* `add` - добавить бота. Варианты:
    * `add random` - бот, всегда отбивающийся/атакующий случайной картой из доступных
    * `add sorted <coeff>` - этот бот сортирует доступные карты и выбирает карту из соответствующего конца списка (н-р, созданный через `add sorted 0` всегда выбирает карту минимального достоинства, `add sorted 0.5` берет среднюю карту, `add sorted 1` - максимальную)
* `start` - начать игру 
* `finish` - распустить комнату
#### В игре
* `take` - взять все карты, которыми вас атакуют
* `end` - закончить свою атаку
* ввод номера карты в руке - использовать эту карту для атаки/защиты
* `finish` - закончить игру и распустить комнату.
 
В нормальных условиях игра продолжается до тех пор, пока не опустеет колода и не останется лишь один игрок с картами. При этом побеждающие игроки выключаются из игры постепенно, с объявлением их места в рейтинге на момент избавления от карт.

Все команды могут быть сокращены до первой буквы, например, `l` вместо `list`.

Клиенты могут отключиться от сервера, выйдя в лобби и введя Ctrl+C в консоль.

## Использованные паттерны проектирования
* Chain of Responsibility - команды клиентов обрабатываются по цепочке обработчиков разных уровней: 
    - лобби (`PlayerManager::handleCommand`)
    - комната (`GameRoom::handleCommand`)
    - игра (`DurakGame::handlePlayerGameCommand`)
* Strategy - выбор стратегии бота
* Command - для пользовательских команд (правда, сейчас они не кладутся в очередь, а обрабатываются сразу, но зато обрабатываются единообразно)

## Использованные возможности C++
* `shared_ptr` и `weak_ptr` - в PlayerManager для хранения GameRoom. Когда на комнату перестает ссылаться хоть один игрок, она автоматически удаляется. `weak_ptr`-ы нужны для работы команды `list`.
* `std::varaint` - для представления различных типов команд
* `unique_ptr` - для хранения и передачи указателей на объекты, имеющие общий интерфейс (`IActor` и `IBotStrategy`).

## Технические требования
Код собирается через CMake, работает на моем arch linux. После сборки в папке build будут лежать card_game_server, card_game_client и test_card_game.

Для проверки/форсирования стиля кода используются кастомные таргеты `check-format` и `fix-format` (после генерации папки build нужно прописать `cmake --build build --target check-format`).

Тесты реализованы через GTest. Их запуск производится через артефакт сборки test_card_game.
